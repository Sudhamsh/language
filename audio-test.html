<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Test - Language Flashcards</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        h2 {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }
        button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
        }
        button:hover {
            background: #4338ca;
        }
        #log {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .success {
            color: #4ec9b0;
        }
        .error {
            color: #f48771;
        }
        .info {
            color: #dcdcaa;
        }
        .voice-list {
            max-height: 200px;
            overflow-y: auto;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        .voice-item {
            padding: 5px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <h1>üîä Audio Diagnosis Tool</h1>
    <p>This page will help diagnose why audio isn't playing.</p>

    <div class="test-section">
        <h2>Test 1: Basic Browser Support</h2>
        <button onclick="testBasicSupport()">Check Browser Support</button>
        <div id="support-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Simple English Speech</h2>
        <button onclick="testEnglish()">Speak "Hello World"</button>
        <p style="color: #666; font-size: 0.9rem;">If you don't hear this, the problem is with your browser/system, not the app.</p>
    </div>

    <div class="test-section">
        <h2>Test 3: Check Available Voices</h2>
        <button onclick="listVoices()">List All Voices</button>
        <div id="voice-list" class="voice-list"></div>
    </div>

    <div class="test-section">
        <h2>Test 4: Telugu Voice</h2>
        <button onclick="testTelugu()">Speak "‡∞®‡∞Æ‡∞∏‡±ç‡∞ï‡∞æ‡∞∞‡∞Ç" (Namaskaram)</button>
    </div>

    <div class="test-section">
        <h2>Test 5: Spanish Voice</h2>
        <button onclick="testSpanish()">Speak "Hola"</button>
    </div>

    <div class="test-section">
        <h2>Test 6: French Voice</h2>
        <button onclick="testFrench()">Speak "Bonjour"</button>
    </div>

    <div class="test-section">
        <h2>Console Log</h2>
        <div id="log"></div>
    </div>

    <script>
        const speech = window.speechSynthesis;
        let voices = [];
        let voicesLoaded = false;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const line = document.createElement('div');
            line.className = type;
            line.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(line);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        // Load voices
        function loadVoices() {
            voices = speech.getVoices();
            voicesLoaded = true;
            log(`Loaded ${voices.length} voices`, 'success');
        }

        // Chrome loads voices asynchronously
        loadVoices();
        if (speech.onvoiceschanged !== undefined) {
            speech.onvoiceschanged = loadVoices;
        }

        function testBasicSupport() {
            const resultDiv = document.getElementById('support-result');

            if (!window.speechSynthesis) {
                resultDiv.innerHTML = '<p class="error">‚ùå Speech Synthesis NOT supported in this browser!</p>';
                log('Speech Synthesis NOT supported', 'error');
                return;
            }

            resultDiv.innerHTML = '<p class="success">‚úÖ Speech Synthesis is supported!</p>';
            log('Speech Synthesis is supported', 'success');
            log(`Browser: ${navigator.userAgent}`, 'info');
        }

        function testEnglish() {
            log('Testing English speech...', 'info');

            if (!voicesLoaded || voices.length === 0) {
                log('Waiting for voices to load...', 'info');
                setTimeout(testEnglish, 100);
                return;
            }

            speech.cancel();
            const utterance = new SpeechSynthesisUtterance("Hello World");

            // Use default voice
            const defaultVoice = voices.find(v => v.default) || voices[0];
            if (defaultVoice) {
                utterance.voice = defaultVoice;
                log(`Using voice: ${defaultVoice.name} (${defaultVoice.lang})`, 'info');
            }

            utterance.onstart = () => log('‚úì Started speaking English', 'success');
            utterance.onend = () => log('‚úì Finished speaking English', 'success');
            utterance.onerror = (e) => log(`‚úó Error: ${e.error}`, 'error');

            speech.speak(utterance);
            log('Initiated English speech', 'info');
        }

        function listVoices() {
            const voiceList = document.getElementById('voice-list');

            if (!voicesLoaded || voices.length === 0) {
                log('Waiting for voices to load...', 'info');
                setTimeout(listVoices, 100);
                return;
            }

            log(`Found ${voices.length} voices`, 'success');

            voiceList.innerHTML = '<h3>Available Voices:</h3>';

            // Group by language
            const teluguVoices = voices.filter(v => v.lang.startsWith('te'));
            const spanishVoices = voices.filter(v => v.lang.startsWith('es'));
            const frenchVoices = voices.filter(v => v.lang.startsWith('fr'));
            const englishVoices = voices.filter(v => v.lang.startsWith('en'));

            const addVoiceSection = (title, voiceList) => {
                if (voiceList.length > 0) {
                    const section = document.createElement('div');
                    section.innerHTML = `<strong>${title} (${voiceList.length}):</strong>`;
                    voiceList.forEach(v => {
                        const item = document.createElement('div');
                        item.className = 'voice-item';
                        item.textContent = `${v.name} [${v.lang}]${v.default ? ' (default)' : ''}`;
                        section.appendChild(item);
                    });
                    voiceList.appendChild(section);
                }
            };

            if (teluguVoices.length > 0) {
                log(`‚úì Telugu voices found: ${teluguVoices.length}`, 'success');
                addVoiceSection('Telugu Voices', teluguVoices);
            } else {
                log('‚ö† No Telugu voices found - will use default voice', 'error');
                voiceList.innerHTML += '<p class="error">‚ùå No Telugu voices available</p>';
            }

            if (spanishVoices.length > 0) {
                log(`‚úì Spanish voices found: ${spanishVoices.length}`, 'success');
                addVoiceSection('Spanish Voices', spanishVoices);
            } else {
                log('‚ö† No Spanish voices found', 'error');
            }

            if (frenchVoices.length > 0) {
                log(`‚úì French voices found: ${frenchVoices.length}`, 'success');
                addVoiceSection('French Voices', frenchVoices);
            } else {
                log('‚ö† No French voices found', 'error');
            }

            addVoiceSection('English Voices', englishVoices.slice(0, 5));
        }

        function testTelugu() {
            log('Testing Telugu speech...', 'info');

            if (!voicesLoaded || voices.length === 0) {
                log('Waiting for voices to load...', 'info');
                setTimeout(testTelugu, 100);
                return;
            }

            speech.cancel();
            const utterance = new SpeechSynthesisUtterance("‡∞®‡∞Æ‡∞∏‡±ç‡∞ï‡∞æ‡∞∞‡∞Ç");

            // Find Telugu voice
            let voice = voices.find(v => v.lang.startsWith('te'));

            if (!voice) {
                log('No Telugu voice found, using default', 'error');
                voice = voices.find(v => v.default) || voices[0];
            }

            if (voice) {
                utterance.voice = voice;
                log(`Using voice: ${voice.name} (${voice.lang})`, 'info');
            }

            utterance.onstart = () => log('‚úì Started speaking Telugu', 'success');
            utterance.onend = () => log('‚úì Finished speaking Telugu', 'success');
            utterance.onerror = (e) => log(`‚úó Error: ${e.error}`, 'error');

            speech.speak(utterance);
        }

        function testSpanish() {
            log('Testing Spanish speech...', 'info');

            if (!voicesLoaded || voices.length === 0) {
                log('Waiting for voices to load...', 'info');
                setTimeout(testSpanish, 100);
                return;
            }

            speech.cancel();
            const utterance = new SpeechSynthesisUtterance("Hola");

            let voice = voices.find(v => v.lang.startsWith('es'));

            if (!voice) {
                log('No Spanish voice found, using default', 'error');
                voice = voices.find(v => v.default) || voices[0];
            }

            if (voice) {
                utterance.voice = voice;
                log(`Using voice: ${voice.name} (${voice.lang})`, 'info');
            }

            utterance.onstart = () => log('‚úì Started speaking Spanish', 'success');
            utterance.onend = () => log('‚úì Finished speaking Spanish', 'success');
            utterance.onerror = (e) => log(`‚úó Error: ${e.error}`, 'error');

            speech.speak(utterance);
        }

        function testFrench() {
            log('Testing French speech...', 'info');

            if (!voicesLoaded || voices.length === 0) {
                log('Waiting for voices to load...', 'info');
                setTimeout(testFrench, 100);
                return;
            }

            speech.cancel();
            const utterance = new SpeechSynthesisUtterance("Bonjour");

            let voice = voices.find(v => v.lang.startsWith('fr'));

            if (!voice) {
                log('No French voice found, using default', 'error');
                voice = voices.find(v => v.default) || voices[0];
            }

            if (voice) {
                utterance.voice = voice;
                log(`Using voice: ${voice.name} (${voice.lang})`, 'info');
            }

            utterance.onstart = () => log('‚úì Started speaking French', 'success');
            utterance.onend = () => log('‚úì Finished speaking French', 'success');
            utterance.onerror = (e) => log(`‚úó Error: ${e.error}`, 'error');

            speech.speak(utterance);
        }

        // Auto-run basic test on load
        window.addEventListener('load', () => {
            log('Page loaded', 'info');
            setTimeout(() => {
                testBasicSupport();
                listVoices();
            }, 500);
        });
    </script>
</body>
</html>
